print("==========================================")
print("  Dobot CR3A ã‚«ãƒ¡ãƒ©æ’®å½±åˆ¶å¾¡")
print("  P1æ’®å½± â†’ P2ç§»å‹• ãƒ«ãƒ¼ãƒ—")
print("==========================================")
print("æ¥ç¶šå…ˆ: 192.168.0.95:502")
print()

-- Modbusæ¥ç¶š
local resultCreate, id = ModbusCreate('192.168.0.95', 502, 1)

if resultCreate ~= 0 then
    print("âŒ Modbusæ¥ç¶šå¤±æ•—")
    print("ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰:", resultCreate)
    return
end

print("âœ… Modbusæ¥ç¶šæˆåŠŸ (ID:", id, ")")
print()

-- ãƒ«ãƒ¼ãƒ—å›æ•°ã®è¨­å®š
local loop_count = 5

print(string.format("ã“ã‚Œã‹ã‚‰ %d å›ã®æ’®å½±ã‚µã‚¤ã‚¯ãƒ«ã‚’å®Ÿè¡Œã—ã¾ã™", loop_count))
print()

-- ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—
for i = 1, loop_count do
    print("==========================================")
    print(string.format("  ã‚µã‚¤ã‚¯ãƒ« %d / %d", i, loop_count))
    print("==========================================")
    print()
    
    -- ========================================
    -- ã‚¹ãƒ†ãƒƒãƒ—1: P1ä½ç½®ã¸ç§»å‹•
    -- ========================================
    print("[ã‚¹ãƒ†ãƒƒãƒ—1] P1ä½ç½®ã¸ç§»å‹•")
    print("ğŸ“ ç§»å‹•ä¸­...")
    MovJ(P1)
    print("âœ… P1åˆ°é”")
    print()
    
    -- ========================================
    -- ã‚¹ãƒ†ãƒƒãƒ—2: æ’®å½±æŒ‡ä»¤é€ä¿¡
    -- ========================================
    print("[ã‚¹ãƒ†ãƒƒãƒ—2] æ’®å½±æŒ‡ä»¤é€ä¿¡")
    print("ğŸ“¤ ãƒˆãƒªã‚¬ãƒ¼é€ä¿¡ (41025 = 1)")
    SetHoldRegs(id, 41025, 1, {1}, "U16")
    print("âœ… é€ä¿¡å®Œäº†")
    print()
    
    -- ========================================
    -- ã‚¹ãƒ†ãƒƒãƒ—3: æ’®å½±å®Œäº†å¾…æ©Ÿ
    -- ========================================
    print("[ã‚¹ãƒ†ãƒƒãƒ—3] æ’®å½±å®Œäº†å¾…æ©Ÿ")
    print("â³ å®Œäº†ãƒ•ãƒ©ã‚°ã‚’ç›£è¦–ä¸­...")
    
    local timeout = 0
    local max_timeout = 200
    
    while true do
        -- â˜…â˜…â˜… PLCã‚¢ãƒ‰ãƒ¬ã‚¹ 41026 ã‹ã‚‰èª­ã¿å–ã‚Š â˜…â˜…â˜…
        local done_flag = GetHoldRegs(id, 41026, 1, "U16")
        
        if done_flag and done_flag[1] == 1 then
            print("âœ… æ’®å½±å®Œäº†ã‚’ç¢ºèª (41026 = 1)"