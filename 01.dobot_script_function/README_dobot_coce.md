# Dobotå´ ä¿®æ­£ç‰ˆLuaã‚¹ã‚¯ãƒªãƒ—ãƒˆ

P1ã§æ’®å½±ã—ã¦P2ã¸ç§»å‹•ã™ã‚‹å‹•ä½œã‚’ç¹°ã‚Šè¿”ã™ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚

---

## ğŸ”„ ä¿®æ­£å¾Œã®å‹•ä½œãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Dobot CR3A ã®ä¿®æ­£å¾Œãƒ•ãƒ­ãƒ¼                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  1. ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•ãƒ»Modbusæ¥ç¶šç¢ºç«‹                        â”‚
â”‚      â†“                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚ãƒ«ãƒ¼ãƒ—é–‹å§‹                     â”‚                      â”‚
â”‚  â”‚  â†“                            â”‚                      â”‚
â”‚  â”‚  2. P1ä½ç½®ã¸ç§»å‹•              â”‚                      â”‚
â”‚  â”‚  â†“                            â”‚                      â”‚
â”‚  â”‚  3. æ’®å½±æŒ‡ä»¤é€ä¿¡ (41025 = 1)  â”‚                      â”‚
â”‚  â”‚  â†“                            â”‚                      â”‚
â”‚  â”‚  4. æ’®å½±å®Œäº†å¾…æ©Ÿ (41026 == 1) â”‚                      â”‚
â”‚  â”‚  â†“                            â”‚                      â”‚
â”‚  â”‚  5. å®Œäº†æ¤œå‡º                  â”‚                      â”‚
â”‚  â”‚  â†“                            â”‚                      â”‚
â”‚  â”‚  6. ãƒˆãƒªã‚¬ãƒ¼ãƒªã‚»ãƒƒãƒˆ (41025=0)â”‚                      â”‚
â”‚  â”‚  â†“                            â”‚                      â”‚
â”‚  â”‚  7. P2ä½ç½®ã¸ç§»å‹•              â”‚                      â”‚
â”‚  â”‚  â†“                            â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚      â†“                                                  â”‚
â”‚  (ãƒ«ãƒ¼ãƒ—ç¶™ç¶š or çµ‚äº†)                                   â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ å®Œå…¨ãªã‚³ãƒ¼ãƒ‰

```lua
print("==========================================")
print("  Dobot CR3A ã‚«ãƒ¡ãƒ©æ’®å½±åˆ¶å¾¡")
print("  P1æ’®å½± â†’ P2ç§»å‹• ãƒ«ãƒ¼ãƒ—")
print("==========================================")
print("æ¥ç¶šå…ˆ: 192.168.0.95:502")
print()

-- Modbusæ¥ç¶š
local resultCreate, id = ModbusCreate('192.168.0.95', 502, 1)

if resultCreate ~= 0 then
    print("âŒ Modbusæ¥ç¶šå¤±æ•—")
    print("ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰:", resultCreate)
    return
end

print("âœ… Modbusæ¥ç¶šæˆåŠŸ (ID:", id, ")")
print()

-- ãƒ«ãƒ¼ãƒ—å›æ•°ã®è¨­å®š
local loop_count = 5  -- 5å›ç¹°ã‚Šè¿”ã™ï¼ˆå¿…è¦ã«å¿œã˜ã¦å¤‰æ›´ï¼‰

print(string.format("ã“ã‚Œã‹ã‚‰ %d å›ã®æ’®å½±ã‚µã‚¤ã‚¯ãƒ«ã‚’å®Ÿè¡Œã—ã¾ã™", loop_count))
print()

-- ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—
for i = 1, loop_count do
    print("==========================================")
    print(string.format("  ã‚µã‚¤ã‚¯ãƒ« %d / %d", i, loop_count))
    print("==========================================")
    print()
    
    -- ========================================
    -- ã‚¹ãƒ†ãƒƒãƒ—1: P1ä½ç½®ã¸ç§»å‹•
    -- ========================================
    print("[ã‚¹ãƒ†ãƒƒãƒ—1] P1ä½ç½®ã¸ç§»å‹•")
    print("ğŸ“ ç§»å‹•ä¸­...")
    MovJ(P1)
    print("âœ… P1åˆ°é”")
    print()
    
    -- ========================================
    -- ã‚¹ãƒ†ãƒƒãƒ—2: æ’®å½±æŒ‡ä»¤é€ä¿¡
    -- ========================================
    print("[ã‚¹ãƒ†ãƒƒãƒ—2] æ’®å½±æŒ‡ä»¤é€ä¿¡")
    print("ğŸ“¤ ãƒˆãƒªã‚¬ãƒ¼é€ä¿¡ (41025 = 1)")
    SetHoldRegs(id, 41025, 1, {1}, "U16")
    print("âœ… é€ä¿¡å®Œäº†")
    print()
    
    -- ========================================
    -- ã‚¹ãƒ†ãƒƒãƒ—3: æ’®å½±å®Œäº†å¾…æ©Ÿ
    -- ========================================
    print("[ã‚¹ãƒ†ãƒƒãƒ—3] æ’®å½±å®Œäº†å¾…æ©Ÿ")
    print("â³ å®Œäº†ãƒ•ãƒ©ã‚°ã‚’ç›£è¦–ä¸­...")
    
    local timeout = 0
    local max_timeout = 200  -- 10ç§’
    
    while true do
        local done_flag = GetHoldRegs(id, 41026, 1, "U16")
        
        -- æ’®å½±å®Œäº†ã‚’ç¢ºèª
        if done_flag and done_flag[1] == 1 then
            print("âœ… æ’®å½±å®Œäº†ã‚’ç¢ºèª (41026 = 1)")
            break
        end
        
        -- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå‡¦ç†
        timeout = timeout + 1
        if timeout > max_timeout then
            print("âŒ ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ (10ç§’çµŒé)")
            print("ç¾åœ¨ã®41026ã®å€¤:", done_flag and done_flag[1] or "nil")
            print("å‡¦ç†ã‚’ä¸­æ–­ã—ã¾ã™")
            return
        end
        
        -- 2ç§’ã”ã¨ã«é€²æ—è¡¨ç¤º
        if timeout % 40 == 0 then
            local elapsed = timeout / 20
            print(string.format("  å¾…æ©Ÿä¸­... %dç§’çµŒé", elapsed))
        end
    end
    print()
    
    -- ========================================
    -- ã‚¹ãƒ†ãƒƒãƒ—4: ãƒˆãƒªã‚¬ãƒ¼ãƒªã‚»ãƒƒãƒˆ
    -- ========================================
    print("[ã‚¹ãƒ†ãƒƒãƒ—4] ãƒˆãƒªã‚¬ãƒ¼ãƒªã‚»ãƒƒãƒˆ")
    print("ğŸ”„ ãƒˆãƒªã‚¬ãƒ¼ã‚’0ã«æˆ»ã—ã¾ã™ (41025 = 0)")
    SetHoldRegs(id, 41025, 1, {0}, "U16")
    print("âœ… ãƒªã‚»ãƒƒãƒˆå®Œäº†")
    print()
    
    -- ========================================
    -- ã‚¹ãƒ†ãƒƒãƒ—5: P2ä½ç½®ã¸ç§»å‹•
    -- ========================================
    print("[ã‚¹ãƒ†ãƒƒãƒ—5] P2ä½ç½®ã¸ç§»å‹•")
    print("ğŸ“ ç§»å‹•ä¸­...")
    MovJ(P2)
    print("âœ… P2åˆ°é”")
    print()
    
    print(string.format("ã‚µã‚¤ã‚¯ãƒ« %d å®Œäº†", i))
    print()
    
    -- æ¬¡ã®ã‚µã‚¤ã‚¯ãƒ«ã¾ã§å°‘ã—å¾…æ©Ÿï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
    if i < loop_count then
        print("æ¬¡ã®ã‚µã‚¤ã‚¯ãƒ«ã¾ã§1ç§’å¾…æ©Ÿ...")
        local start = os.clock()
        while os.clock() - start < 1 do
            -- 1ç§’å¾…æ©Ÿ
        end
        print()
    end
end

-- ========================================
-- å…¨ã‚µã‚¤ã‚¯ãƒ«å®Œäº†
-- ========================================
print("==========================================")
print(string.format("  âœ… å…¨ %d ã‚µã‚¤ã‚¯ãƒ«å®Œäº†", loop_count))
print("==========================================")
print()

-- ãƒ›ãƒ¼ãƒ ãƒã‚¸ã‚·ãƒ§ãƒ³ã¸æˆ»ã‚‹ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
print("ãƒ›ãƒ¼ãƒ ãƒã‚¸ã‚·ãƒ§ãƒ³ã¸ç§»å‹•ä¸­...")
MovJ(Home)
print("âœ… ãƒ›ãƒ¼ãƒ åˆ°é”")
print()

print("ã™ã¹ã¦ã®å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸ")
```

---

## ğŸ¬ å®Ÿéš›ã®å‹•ä½œä¾‹

### **ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›ä¾‹**

```
==========================================
  Dobot CR3A ã‚«ãƒ¡ãƒ©æ’®å½±åˆ¶å¾¡
  P1æ’®å½± â†’ P2ç§»å‹• ãƒ«ãƒ¼ãƒ—
==========================================
æ¥ç¶šå…ˆ: 192.168.0.95:502

âœ… Modbusæ¥ç¶šæˆåŠŸ (ID: 0)

ã“ã‚Œã‹ã‚‰ 5 å›ã®æ’®å½±ã‚µã‚¤ã‚¯ãƒ«ã‚’å®Ÿè¡Œã—ã¾ã™

==========================================
  ã‚µã‚¤ã‚¯ãƒ« 1 / 5
==========================================

[ã‚¹ãƒ†ãƒƒãƒ—1] P1ä½ç½®ã¸ç§»å‹•
ğŸ“ ç§»å‹•ä¸­...
âœ… P1åˆ°é”

[ã‚¹ãƒ†ãƒƒãƒ—2] æ’®å½±æŒ‡ä»¤é€ä¿¡
ğŸ“¤ ãƒˆãƒªã‚¬ãƒ¼é€ä¿¡ (41025 = 1)
âœ… é€ä¿¡å®Œäº†

[ã‚¹ãƒ†ãƒƒãƒ—3] æ’®å½±å®Œäº†å¾…æ©Ÿ
â³ å®Œäº†ãƒ•ãƒ©ã‚°ã‚’ç›£è¦–ä¸­...
  å¾…æ©Ÿä¸­... 2ç§’çµŒé
âœ… æ’®å½±å®Œäº†ã‚’ç¢ºèª (41026 = 1)

[ã‚¹ãƒ†ãƒƒãƒ—4] ãƒˆãƒªã‚¬ãƒ¼ãƒªã‚»ãƒƒãƒˆ
ğŸ”„ ãƒˆãƒªã‚¬ãƒ¼ã‚’0ã«æˆ»ã—ã¾ã™ (41025 = 0)
âœ… ãƒªã‚»ãƒƒãƒˆå®Œäº†

[ã‚¹ãƒ†ãƒƒãƒ—5] P2ä½ç½®ã¸ç§»å‹•
ğŸ“ ç§»å‹•ä¸­...
âœ… P2åˆ°é”

ã‚µã‚¤ã‚¯ãƒ« 1 å®Œäº†

æ¬¡ã®ã‚µã‚¤ã‚¯ãƒ«ã¾ã§1ç§’å¾…æ©Ÿ...

==========================================
  ã‚µã‚¤ã‚¯ãƒ« 2 / 5
==========================================

[ã‚¹ãƒ†ãƒƒãƒ—1] P1ä½ç½®ã¸ç§»å‹•
ğŸ“ ç§»å‹•ä¸­...
âœ… P1åˆ°é”

...ï¼ˆä»¥ä¸‹ç¹°ã‚Šè¿”ã—ï¼‰

==========================================
  âœ… å…¨ 5 ã‚µã‚¤ã‚¯ãƒ«å®Œäº†
==========================================

ãƒ›ãƒ¼ãƒ ãƒã‚¸ã‚·ãƒ§ãƒ³ã¸ç§»å‹•ä¸­...
âœ… ãƒ›ãƒ¼ãƒ åˆ°é”

ã™ã¹ã¦ã®å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸ
```

---

## ğŸ“Š ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãƒãƒ£ãƒ¼ãƒˆ

```
æ™‚åˆ»    Dobotå‹•ä½œ              ãƒ­ãƒœãƒƒãƒˆä½ç½®    ãƒ¬ã‚¸ã‚¹ã‚¿çŠ¶æ…‹
                                             41025  41026
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
0.0s    æ¥ç¶šç¢ºç«‹               åˆæœŸä½ç½®        0      0
        
0.2s    ã€ã‚µã‚¤ã‚¯ãƒ«1é–‹å§‹ã€‘
        MovJ(P1)               ç§»å‹•ä¸­          0      0
        
2.0s                           P1åˆ°é”          0      0
        
2.1s    SetHoldRegs(41025,1)   P1å¾…æ©Ÿ          1      0
        
2.2s    ãƒãƒ¼ãƒªãƒ³ã‚°é–‹å§‹         P1å¾…æ©Ÿ          1      0
        
4.2s    å®Œäº†æ¤œå‡º               P1å¾…æ©Ÿ          1      1
        
4.3s    SetHoldRegs(41025,0)   P1å¾…æ©Ÿ          0      1
        
4.4s    MovJ(P2)               ç§»å‹•ä¸­          0      0
        
6.0s                           P2åˆ°é”          0      0
        
7.0s    1ç§’å¾…æ©Ÿ                P2å¾…æ©Ÿ          0      0
        
8.0s    ã€ã‚µã‚¤ã‚¯ãƒ«2é–‹å§‹ã€‘
        MovJ(P1)               ç§»å‹•ä¸­          0      0
        
10.0s                          P1åˆ°é”          0      0
        
...     ï¼ˆä»¥ä¸‹ç¹°ã‚Šè¿”ã—ï¼‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1ã‚µã‚¤ã‚¯ãƒ«: ç´„6-7ç§’
5ã‚µã‚¤ã‚¯ãƒ«: ç´„30-35ç§’
```

---

## ğŸ¨ ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºä¾‹

### **1. ç„¡é™ãƒ«ãƒ¼ãƒ—ç‰ˆ**

```lua
-- ç„¡é™ã«ç¹°ã‚Šè¿”ã™
while true do
    -- P1ã¸ç§»å‹•
    MovJ(P1)
    
    -- æ’®å½±
    SetHoldRegs(id, 41025, 1, {1}, "U16")
    
    -- å®Œäº†å¾…æ©Ÿ
    while true do
        local done = GetHoldRegs(id, 41026, 1, "U16")
        if done and done[1] == 1 then
            break
        end
    end
    
    -- ãƒªã‚»ãƒƒãƒˆ
    SetHoldRegs(id, 41025, 1, {0}, "U16")
    
    -- P2ã¸ç§»å‹•
    MovJ(P2)
    
    -- å°‘ã—å¾…æ©Ÿ
    local start = os.clock()
    while os.clock() - start < 1 do
    end
end
```

---

### **2. è¤‡æ•°ä½ç½®å¯¾å¿œç‰ˆ**

```lua
-- æ’®å½±ä½ç½®ã®ãƒªã‚¹ãƒˆ
local positions = {P1, P3, P5, P7}  -- 4ç®‡æ‰€ã§æ’®å½±

for cycle = 1, 3 do  -- 3å‘¨ã™ã‚‹
    print(string.format("=== å‘¨å› %d ===", cycle))
    
    for i, pos in ipairs(positions) do
        print(string.format("ä½ç½® %d ã§æ’®å½±", i))
        
        -- æ’®å½±ä½ç½®ã¸ç§»å‹•
        MovJ(pos)
        
        -- æ’®å½±å®Ÿè¡Œ
        SetHoldRegs(id, 41025, 1, {1}, "U16")
        
        -- å®Œäº†å¾…æ©Ÿ
        while true do
            local done = GetHoldRegs(id, 41026, 1, "U16")
            if done and done[1] == 1 then
                break
            end
        end
        
        -- ãƒªã‚»ãƒƒãƒˆ
        SetHoldRegs(id, 41025, 1, {0}, "U16")
        
        print(string.format("ä½ç½® %d å®Œäº†", i))
    end
    
    -- 1å‘¨çµ‚ã‚ã£ãŸã‚‰P2ï¼ˆé€€é¿ä½ç½®ï¼‰ã¸
    MovJ(P2)
    print("1å‘¨å®Œäº†ã€å¾…æ©Ÿä½ç½®ã¸ç§»å‹•")
end
```

---

### **3. ã‚¨ãƒ©ãƒ¼ãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½ä»˜ã**

```lua
-- æ’®å½±é–¢æ•°ï¼ˆãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½ä»˜ãï¼‰
function capture_with_retry(id, max_retry)
    for retry = 1, max_retry do
        print(string.format("æ’®å½±è©¦è¡Œ %d / %d", retry, max_retry))
        
        -- ãƒˆãƒªã‚¬ãƒ¼é€ä¿¡
        SetHoldRegs(id, 41025, 1, {1}, "U16")
        
        -- å®Œäº†å¾…æ©Ÿï¼ˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆä»˜ãï¼‰
        local timeout = 0
        while timeout < 200 do
            local done = GetHoldRegs(id, 41026, 1, "U16")
            if done and done[1] == 1 then
                -- æˆåŠŸ
                SetHoldRegs(id, 41025, 1, {0}, "U16")
                print("âœ… æ’®å½±æˆåŠŸ")
                return true
            end
            timeout = timeout + 1
        end
        
        -- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
        print("âš ï¸  ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã€ãƒªãƒˆãƒ©ã‚¤ã—ã¾ã™")
        SetHoldRegs(id, 41025, 1, {0}, "U16")
        
        -- å°‘ã—å¾…æ©Ÿ
        local start = os.clock()
        while os.clock() - start < 2 do
        end
    end
    
    -- ã™ã¹ã¦å¤±æ•—
    print("âŒ æ’®å½±å¤±æ•—ï¼ˆæœ€å¤§ãƒªãƒˆãƒ©ã‚¤å›æ•°è¶…éï¼‰")
    return false
end

-- ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—
for i = 1, 5 do
    MovJ(P1)
    
    if capture_with_retry(id, 3) then  -- æœ€å¤§3å›ãƒªãƒˆãƒ©ã‚¤
        MovJ(P2)
    else
        print("ã‚¨ãƒ©ãƒ¼ã®ãŸã‚å‡¦ç†ã‚’ä¸­æ–­ã—ã¾ã™")
        return
    end
end
```

---

### **4. æ’®å½±æ¡ä»¶åˆ†å²ç‰ˆ**

```lua
-- æ¡ä»¶ã«å¿œã˜ã¦å‹•ä½œã‚’å¤‰ãˆã‚‹
for i = 1, 10 do
    MovJ(P1)
    
    -- æ’®å½±
    SetHoldRegs(id, 41025, 1, {1}, "U16")
    while true do
        local done = GetHoldRegs(id, 41026, 1, "U16")
        if done and done[1] == 1 then
            break
        end
    end
    SetHoldRegs(id, 41025, 1, {0}, "U16")
    
    -- å¶æ•°å›ã¯ P2ã€å¥‡æ•°å›ã¯ P3 ã¸ç§»å‹•
    if i % 2 == 0 then
        print("P2ã¸ç§»å‹•ï¼ˆå¶æ•°å›ï¼‰")
        MovJ(P2)
    else
        print("P3ã¸ç§»å‹•ï¼ˆå¥‡æ•°å›ï¼‰")
        MovJ(P3)
    end
end
```

---

## ğŸ”§ æ’®å½±é–¢æ•°ã®å…±é€šåŒ–ï¼ˆæ¨å¥¨ï¼‰

```lua
-- ========================================
-- æ’®å½±å‡¦ç†ã‚’é–¢æ•°åŒ–
-- ========================================
function capture_image(modbus_id)
    -- æ’®å½±æŒ‡ä»¤é€ä¿¡
    SetHoldRegs(modbus_id, 41025, 1, {1}, "U16")
    print("ğŸ“¤ æ’®å½±æŒ‡ä»¤é€ä¿¡")
    
    -- å®Œäº†å¾…æ©Ÿ
    local timeout = 0
    while true do
        local done_flag = GetHoldRegs(modbus_id, 41026, 1, "U16")
        
        if done_flag and done_flag[1] == 1 then
            print("âœ… æ’®å½±å®Œäº†")
            break
        end
        
        timeout = timeout + 1
        if timeout > 200 then
            print("âŒ æ’®å½±ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ")
            return false
        end
        
        if timeout % 40 == 0 then
            print(string.format("  å¾…æ©Ÿä¸­... %dç§’", timeout/20))
        end
    end
    
    -- ãƒˆãƒªã‚¬ãƒ¼ãƒªã‚»ãƒƒãƒˆ
    SetHoldRegs(modbus_id, 41025, 1, {0}, "U16")
    print("ğŸ”„ ãƒˆãƒªã‚¬ãƒ¼ãƒªã‚»ãƒƒãƒˆ")
    
    return true
end

-- ========================================
-- ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚°ãƒ©ãƒ 
-- ========================================
print("==========================================")
print("  Dobot CR3A ã‚«ãƒ¡ãƒ©æ’®å½±åˆ¶å¾¡")
print("==========================================")

-- Modbusæ¥ç¶š
local resultCreate, id = ModbusCreate('192.168.0.95', 502, 1)
if resultCreate ~= 0 then
    print("âŒ Modbusæ¥ç¶šå¤±æ•—:", resultCreate)
    return
end
print("âœ… Modbusæ¥ç¶šæˆåŠŸ")
print()

-- æ’®å½±ã‚µã‚¤ã‚¯ãƒ«
for i = 1, 5 do
    print(string.format("=== ã‚µã‚¤ã‚¯ãƒ« %d ===", i))
    
    -- P1ã¸ç§»å‹•ã—ã¦æ’®å½±
    print("P1ã¸ç§»å‹•")
    MovJ(P1)
    
    if not capture_image(id) then
        print("æ’®å½±å¤±æ•—ã€å‡¦ç†ã‚’ä¸­æ–­ã—ã¾ã™")
        return
    end
    
    -- P2ã¸ç§»å‹•
    print("P2ã¸ç§»å‹•")
    MovJ(P2)
    print()
end

print("âœ… ã™ã¹ã¦ã®å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸ")
```

---

## âš™ï¸ è¨­å®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

ã‚³ãƒ¼ãƒ‰ã®å…ˆé ­ã§è¨­å®šã‚’å¤‰æ›´ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ä¾‹ï¼š

```lua
-- ========================================
-- è¨­å®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
-- ========================================
local CONFIG = {
    -- Modbusè¨­å®š
    pc_ip = "192.168.0.95",
    pc_port = 502,
    timeout_sec = 1,
    
    -- æ’®å½±è¨­å®š
    trigger_addr = 41025,
    done_addr = 41026,
    capture_timeout = 200,  -- 10ç§’
    
    -- å‹•ä½œè¨­å®š
    loop_count = 5,          -- ç¹°ã‚Šè¿”ã—å›æ•°
    wait_between_cycles = 1, -- ã‚µã‚¤ã‚¯ãƒ«é–“å¾…æ©Ÿæ™‚é–“ï¼ˆç§’ï¼‰
}

-- ========================================
-- ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚°ãƒ©ãƒ 
-- ========================================
local resultCreate, id = ModbusCreate(
    CONFIG.pc_ip, 
    CONFIG.pc_port, 
    CONFIG.timeout_sec
)

-- ...ï¼ˆä»¥ä¸‹ã€CONFIG.xxx ã‚’ä½¿ç”¨ï¼‰
```

---

ã“ã®ã‚³ãƒ¼ãƒ‰ã§ã€**P1æ’®å½± â†’ P2ç§»å‹•** ã®ã‚µã‚¤ã‚¯ãƒ«ã‚’ä»»æ„ã®å›æ•°ç¹°ã‚Šè¿”ã™ã“ã¨ãŒã§ãã¾ã™ï¼